<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>JWT and OAuth2 Notes</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 20px;
            background-color: #f1f1f1;
            line-height: 1.6;
            transition: background-color 0.3s, color 0.3s;
        }
        .white-bg { background-color: #ffffff; color: #333; }
        .grey-bg { background-color: #e0e0e0; color: #333; }
        .black-bg { background-color: #1a1a1a; color: #ffffff; }
        .bg-switcher {
            position: fixed;
            top: 10px;
            right: 10px;
            z-index: 1000;
            font-size: 16px;
        }
        .bg-switcher label { 
            margin-right: 10px; 
            color: inherit;
        }
        .bg-switcher select {
            padding: 5px;
            border-radius: 5px;
            background-color: #04AA6D;
            color: white;
            border: none;
            cursor: pointer;
        }
        .bg-switcher select:focus {
            outline: 2px solid #059862;
        }
        .sidebar {
            width: 250px;
            background-color: #04AA6D;
            position: fixed;
            top: 0;
            left: 0;
            height: 100%;
            padding-top: 20px;
            color: white;
            overflow-y: auto;
        }
        .sidebar-title {
            font-size: 24px;
            text-align: center;
            margin-bottom: 30px;
        }
        .sidebar-link {
            display: block;
            padding: 12px 20px;
            color: white;
            text-decoration: none;
            font-size: 18px;
            transition: background-color 0.3s;
        }
        .sidebar-link:hover { background-color: #059862; }
        .sidebar-link:focus {
            outline: 2px solid white;
        }
        .main-content { 
            margin-left: 270px; 
            padding: 30px; 
        }
        .header {
            background-color: #282A35;
            color: white;
            padding: 20px;
            text-align: center;
            border-radius: 8px;
            margin-bottom: 20px;
        }
        .header-title { font-size: 36px; margin: 0; }
        .header-subtitle { font-size: 18px; margin-top: 10px; }
        .section {
            margin: 20px 0;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
        }
        .white-bg .section { background-color: #f9f9f9; }
        .grey-bg .section { background-color: #d0d0d0; }
        .black-bg .section { background-color: #2a2a2a; }
        .section-title { font-size: 28px; color: #04AA6D; margin-bottom: 15px; }
        .subsection-title { font-size: 22px; margin: 15px 0 10px; color: inherit; }
        table {
            width: 100%;
            border-collapse: collapse;
            margin: 20px 0;
            background-color: #1a1a1a; /* Always black background */
            color: white; /* Always white text */
            font-size: 16px; /* Improved readability */
            overflow-x: auto;
        }
        th, td {
            padding: 14px; /* Increased padding for better spacing */
            text-align: left;
            border: 1px solid #444; /* Subtle borders for clarity */
        }
        th {
            background-color: #04AA6D; /* Keep header green */
            color: white;
            font-weight: bold;
        }
        td {
            background-color: #1a1a1a; /* Ensure cell background is black */
        }
        tr:nth-child(even) {
            background-color: #2a2a2a; /* Slightly lighter black for even rows */
        }
        .content-line {
            font-size: 16px;
            margin: 8px 0;
            padding: 10px;
            border-left: 4px solid #04AA6D;
        }
        .content-line.black-highlight {
            border-left: 4px solid #000000;
        }
        .white-bg .content-line { background-color: #f0f0f0; }
        .grey-bg .content-line { background-color: #c0c0c0; }
        .black-bg .content-line { background-color: #333333; }
        .code-block {
            padding: 15px;
            border-radius: 5px;
            font-family: 'Courier New', Courier, monospace;
            font-size: 16px;
            overflow-x: auto;
            margin: 10px 0;
            background-color: #1a1a1a; /* Always black background */
            color: white; /* Always white text */
        }
        .code-block::-webkit-scrollbar {
            height: 8px;
        }
        .code-block::-webkit-scrollbar-thumb {
            background-color: #04AA6D;
            border-radius: 4px;
        }
        .code-block::-webkit-scrollbar-track {
            background-color: #f1f1f1;
        }
        /* Syntax Highlighting for Code Blocks */
        .keyword-highlight { color: #ff79c6; } /* Keywords like public, void */
        .method-highlight { color: #50fa7b; } /* Method names */
        .annotation-highlight { color: #8be9fd; } /* Annotations like @Autowired */
        .string-highlight { color: #f1fa8c; } /* Strings */
        .comment-highlight { color: #6272a4; } /* Comments */
        .class-highlight { color: #bd93f9; } /* Class names and types */
        .tag-highlight { color: #ff5555; } /* XML tags */
        .attribute-highlight { color: #ff79c6; } /* XML attributes */
        .property-highlight { color: #8be9fd; } /* Properties in application.properties */
        .value-highlight { color: #f1fa8c; } /* Values in application.properties */
        .highlight { color: #FF4500; font-weight: bold; }
        .code-heading {
            color: #000000;
            font-weight: bold;
            font-size: 16px;
        }
        a { color: #04AA6D; text-decoration: none; }
        a:hover { text-decoration: underline; }
        ul, ol { margin: 10px 0; padding-left: 20px; }
        li { margin: 5px 0; }
        @media (max-width: 768px) {
            .sidebar {
                width: 100%;
                height: auto;
                position: relative;
            }
            .main-content {
                margin-left: 0;
            }
        }
    </style>
</head>
<body class="white-bg">
    <div class="bg-switcher">
        <label for="bg-select">Background:</label>
        <select id="bg-select" onchange="changeBackground()">
            <option value="white-bg">White</option>
            <option value="grey-bg">Grey</option>
            <option value="black-bg">Black</option>
        </select>
    </div>
    <div class="sidebar">
        <div class="sidebar-title">JWT & OAuth2 Notes</div>
        <a href="#section1" class="sidebar-link">1. Introduction to JWT</a>
        <a href="#section2" class="sidebar-link">2. Cryptography Basics</a>
        <a href="#section3" class="sidebar-link">3. JWT Spring Boot Project</a>
        <a href="#section4" class="sidebar-link">4. User Model & Repository</a>
        <a href="#section5" class="sidebar-link">5. User Details Service</a>
        <a href="#section6" class="sidebar-link">6. User Controller</a>
        <a href="#section7" class="sidebar-link">7. JWT Service</a>
        <a href="#section8" class="sidebar-link">8. JWT Filter</a>
        <a href="#section9" class="sidebar-link">9. Security Configuration</a>
        <a href="#section10" class="sidebar-link">10. OAuth2 Project</a>
        <a href="#section11" class="sidebar-link">11. Token Storage</a>
        <a href="#section12" class="sidebar-link">12. JWT Pitfalls</a>
        <a href="#section13" class="sidebar-link">13. Databases Used</a>
        <a href="#section14" class="sidebar-link">14. Key Takeaways</a>
        <a href="#section15" class="sidebar-link">15. Testing & Integration</a>
        <a href="#section16" class="sidebar-link">16. Additional Notes</a>
    </div>
    <div class="main-content">
        <div class="header">
            <h1 class="header-title">JWT and OAuth2 Notes</h1>
            <p class="header-subtitle">A comprehensive guide to authentication with JWT and OAuth2 in Spring Boot</p>
        </div>

        <div class="section" id="section1">
            <h2 class="section-title">1. Introduction to JWT</h2>
            <h3 class="subsection-title">Explanation</h3>
            <p class="content-line">JSON Web Tokens (JWT) are a standard (RFC 7519) for securely transmitting information between a client (e.g., a browser or mobile app) and a server, primarily for authentication. A JWT is like a digital ticket: it proves your identity and is valid for a specific time. It consists of three parts—<strong>Header</strong>, <strong>Payload</strong>, and <strong>Signature</strong>—encoded in Base64 and separated by dots (e.g., <code>xxxxx.yyyyy.zzzzz</code>). JWTs are <strong>stateless</strong>, meaning the server doesn’t store session data, making them ideal for scalable applications. When you log in, the server generates a JWT, sends it to the client, and the client includes it in the <code>Authorization</code> header (as <code>Bearer <token></code>) for subsequent requests. The server verifies the token to grant access.</p>
            <h3 class="subsection-title">Key Points</h3>
            <ul class="content-line">
                <li><strong>Purpose</strong>: Securely authenticates users without server-side session storage.</li>
                <li><strong>Why Use JWT?</strong>
                    <ul>
                        <li>Eliminates server-side session storage, enhancing scalability.</li>
                        <li>Works across platforms (web, mobile, APIs).</li>
                        <li>Supports single sign-on (SSO) by sharing tokens across services.</li>
                        <li>Signed to prevent tampering.</li>
                    </ul>
                </li>
                <li><strong>Use Case</strong>: Common in REST APIs, mobile apps, and microservices for user authentication.</li>
                <li><strong>Components</strong>:
                    <ul>
                        <li><strong>Header</strong>: Specifies the token type (<code>JWT</code>) and signing algorithm (e.g., HMAC-SHA256).</li>
                        <li><strong>Payload</strong>: Contains claims like user ID (<code>sub</code>), issuance time (<code>iat</code>), and expiration time (<code>exp</code>).</li>
                        <li><strong>Signature</strong>: Ensures the token’s integrity by signing the Header and Payload with a secret key.</li>
                    </ul>
                </li>
                <li><strong>Workflow</strong>:
                    <ol>
                        <li>User logs in with credentials.</li>
                        <li>Server generates and signs a JWT.</li>
                        <li>Client stores the JWT and sends it with requests.</li>
                        <li>Server verifies the JWT’s signature and claims.</li>
                    </ol>
                </li>
            </ul>
            <h3 class="subsection-title">Example Context</h3>
            <p class="content-line">Imagine a coffee shop issuing a signed monthly pass to Naveen. Instead of checking a list each time, any branch verifies the pass’s signature to serve him. Similarly, JWTs allow servers to verify user identity without database lookups.</p>
            <p class="content-line black-highlight"><strong>Beginner Tip</strong>: A JWT is like a signed hall pass—you show it to access resources without the server checking a database.</p>
        </div>

        <div class="section" id="section2">
            <h2 class="section-title">2. Cryptography Basics for JWT</h2>
            <h3 class="subsection-title">Explanation</h3>
            <p class="content-line">Cryptography secures data on the internet, where hackers might intercept or alter it. It’s like locking a letter in a safe so only the intended recipient can read it. Cryptography uses <strong>encryption</strong> to convert readable data (plaintext) into unreadable code (ciphertext) with a key, and <strong>decryption</strong> to convert it back. JWTs use cryptography to sign tokens, ensuring they’re authentic and unchanged.</p>
            <h3 class="subsection-title">Key Points</h3>
            <ul class="content-line">
                <li><strong>Purpose</strong>: Protects data integrity and authenticity.</li>
                <li><strong>Types</strong>:
                    <ul>
                        <li><strong>Symmetric Cryptography</strong>: Uses one shared key for encryption and decryption (fast but requires secure key sharing).</li>
                        <li><strong>Asymmetric Cryptography</strong>: Uses a public key (shared) and private key (secret) for encryption/decryption (slower but easier to share keys).</li>
                    </ul>
                </li>
                <li><strong>Digital Signatures</strong>: Prove the sender’s identity and prevent tampering, used in JWTs for the Signature part.</li>
                <li><strong>Algorithms</strong>:
                    <ul>
                        <li>Symmetric: AES (strong, modern), DES (older, less secure).</li>
                        <li>Asymmetric: RSA (widely used), ECC (efficient for mobile).</li>
                    </ul>
                </li>
            </ul>
            <p class="content-line black-highlight"><strong>Beginner Tip</strong>: Cryptography is like a locked box—only the person with the key can open it.</p>
            <h3 class="subsection-title">Symmetric Key Cryptography</h3>
            <p class="content-line">Uses one key for both encryption and decryption. If Alice encrypts a message, Bob needs the same key to decrypt it. Common for signing JWTs (e.g., HMAC-SHA256). The challenge is securely sharing the key—if a hacker gets it, they can forge tokens. Example: A JWT’s Signature is created with a secret key, and only the server with that key can verify it.</p>
            <h3 class="subsection-title">Asymmetric Key Cryptography</h3>
            <p class="content-line">Uses a public key (shared openly) and a private key (kept secret). If Alice encrypts with Bob’s public key, only Bob’s private key can decrypt it. In JWTs, algorithms like RSA can sign tokens—server signs with the private key, clients verify with the public key. Advantage: Public keys can be shared freely. Example: A server signs a JWT with its private key, and clients verify it with the public key.</p>
            <h3 class="subsection-title">Digital Signatures</h3>
            <p class="content-line">Prove the sender’s identity and ensure data hasn’t been altered. Alice signs a message (or its hash) with her private key, and Bob verifies it with her public key. In JWTs, the Signature ensures the Header and Payload haven’t been tampered with. Provides <strong>non-repudiation</strong>—Alice can’t deny sending the message. Example: If a JWT’s Payload is changed, the Signature won’t match, and the server rejects it.</p>
        </div>

        <div class="section" id="section3">
            <h2 class="section-title">3. Creating a JWT-Based Spring Boot Project</h2>
            <h3 class="subsection-title">Explanation</h3>
            <p class="content-line">We’ll build a Spring Boot application for a student management system using JWT for authentication, based on the <a href="https://github.com/navinreddy20/spring6-course/tree/80e0c059c5c259ef6009838a934ed9e92865c3d7/14.1%20JWT">GitHub repository</a>. The app uses Spring Security, a PostgreSQL database, and the <code>jjwt</code> library. Key components include a <code>UserController</code> for login/registration, a <code>JwtService</code> for token creation/validation, a <code>JwtFilter</code> to check tokens, and refresh token support. The setup is stateless, with public endpoints (<code>/register</code>, <code>/login</code>, <code>/refresh</code>) open and others requiring tokens.</p>
            <h3 class="subsection-title">Key Steps</h3>
            <ol class="content-line">
                <li><strong>Spring Initializr Setup</strong>:
                    <ul>
                        <li><strong>Project Type</strong>: Maven</li>
                        <li><strong>Language</strong>: Java</li>
                        <li><strong>Spring Boot Version</strong>: 3.1.x (or latest)</li>
                        <li><strong>Group ID</strong>: <code>com.example</code></li>
                        <li><strong>Artifact ID</strong>: <code>teluskosecurity</code></li>
                        <li><strong>Packaging</strong>: JAR</li>
                        <li><strong>Java Version</strong>: 17</li>
                        <li><strong>Dependencies</strong>:
                            <ul>
                                <li><strong>Spring Boot Starter Security</strong>: For authentication and authorization.</li>
                                <li><strong>Spring Boot Starter Web</strong>: For REST APIs.</li>
                                <li><strong>Spring Boot Starter Data JPA</strong>: For database operations.</li>
                                <li><strong>PostgreSQL</strong>: Database driver.</li>
                                <li><strong>jjwt</strong>: For JWT handling (<code>jjwt-api</code>, <code>jjwt-impl</code>, <code>jjwt-jackson</code>).</li>
                            </ul>
                        </li>
                    </ul>
                </li>
                <li><strong>Project Generation</strong>: Generate the project, download, and unzip it. Open in an IDE like IntelliJ IDEA.</li>
                <li><strong>Verify Dependencies</strong>: Check <code>pom.xml</code> for dependencies.</li>
                <li><strong>Configure Database</strong>: Set up PostgreSQL connection in <code>application.properties</code>.</li>
                <li><strong>Run the Application</strong>: Ensure the application runs without errors.</li>
            </ol>
            <h3 class="subsection-title">Code Reference</h3>
            <p class="code-heading">pom.xml</p>
            <pre class="code-block">
<span class="tag-highlight">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span>
<span class="tag-highlight">&lt;project</span> <span class="attribute-highlight">xmlns</span>=<span class="string-highlight">"http://maven.apache.org/POM/4.0.0"</span> <span class="attribute-highlight">xmlns:xsi</span>=<span class="string-highlight">"http://www.w3.org/2001/XMLSchema-instance"</span>
         <span class="attribute-highlight">xsi:schemaLocation</span>=<span class="string-highlight">"http://maven.apache.org/POM/4.0.0 https://maven.apache.org/xsd/maven-4.0.0.xsd"</span><span class="tag-highlight">&gt;</span>
    <span class="comment-highlight">&lt;!-- Defines the Maven project structure and metadata --&gt;</span>
    <span class="tag-highlight">&lt;modelVersion&gt;</span>4.0.0<span class="tag-highlight">&lt;/modelVersion&gt;</span>
    <span class="tag-highlight">&lt;parent&gt;</span>
        <span class="tag-highlight">&lt;groupId&gt;</span>org.springframework.boot<span class="tag-highlight">&lt;/groupId&gt;</span>
        <span class="tag-highlight">&lt;artifactId&gt;</span>spring-boot-starter-parent<span class="tag-highlight">&lt;/artifactId&gt;</span>
        <span class="tag-highlight">&lt;version&gt;</span>3.1.0<span class="tag-highlight">&lt;/version&gt;</span>
        <span class="tag-highlight">&lt;relativePath/&gt;</span>
        <span class="comment-highlight">&lt;!-- Inherits Spring Boot defaults for dependency management --&gt;</span>
    <span class="tag-highlight">&lt;/parent&gt;</span>
    <span class="tag-highlight">&lt;groupId&gt;</span>com.example<span class="tag-highlight">&lt;/groupId&gt;</span>
    <span class="tag-highlight">&lt;artifactId&gt;</span>teluskosecurity<span class="tag-highlight">&lt;/artifactId&gt;</span>
    <span class="tag-highlight">&lt;version&gt;</span>0.0.1-SNAPSHOT<span class="tag-highlight">&lt;/version&gt;</span>
    <span class="tag-highlight">&lt;name&gt;</span>teluskosecurity<span class="tag-highlight">&lt;/name&gt;</span>
    <span class="tag-highlight">&lt;description&gt;</span>Demo project for JWT Authentication<span class="tag-highlight">&lt;/description&gt;</span>
    <span class="tag-highlight">&lt;properties&gt;</span>
        <span class="tag-highlight">&lt;java.version&gt;</span>17<span class="tag-highlight">&lt;/java.version&gt;</span>
        <span class="comment-highlight">&lt;!-- Specifies Java 17 for compilation and runtime --&gt;</span>
    <span class="tag-highlight">&lt;/properties&gt;</span>
    <span class="tag-highlight">&lt;dependencies&gt;</span>
        <span class="tag-highlight">&lt;dependency&gt;</span>
            <span class="tag-highlight">&lt;groupId&gt;</span>org.springframework.boot<span class="tag-highlight">&lt;/groupId&gt;</span>
            <span class="tag-highlight">&lt;artifactId&gt;</span>spring-boot-starter-security<span class="tag-highlight">&lt;/artifactId&gt;</span>
            <span class="comment-highlight">&lt;!-- Adds Spring Security for authentication/authorization --&gt;</span>
        <span class="tag-highlight">&lt;/dependency&gt;</span>
        <span class="tag-highlight">&lt;dependency&gt;</span>
            <span class="tag-highlight">&lt;groupId&gt;</span>org.springframework.boot<span class="tag-highlight">&lt;/groupId&gt;</span>
            <span class="tag-highlight">&lt;artifactId&gt;</span>spring-boot-starter-web<span class="tag-highlight">&lt;/artifactId&gt;</span>
            <span class="comment-highlight">&lt;!-- Enables REST API development with Spring MVC --&gt;</span>
        <span class="tag-highlight">&lt;/dependency&gt;</span>
        <span class="tag-highlight">&lt;dependency&gt;</span>
            <span class="tag-highlight">&lt;groupId&gt;</span>org.springframework.boot<span class="tag-highlight">&lt;/groupId&gt;</span>
            <span class="tag-highlight">&lt;artifactId&gt;</span>spring-boot-starter-data-jpa<span class="tag-highlight">&lt;/artifactId&gt;</span>
            <span class="comment-highlight">&lt;!-- Provides JPA for database operations --&gt;</span>
        <span class="tag-highlight">&lt;/dependency&gt;</span>
        <span class="tag-highlight">&lt;dependency&gt;</span>
            <span class="tag-highlight">&lt;groupId&gt;</span>org.postgresql<span class="tag-highlight">&lt;/groupId&gt;</span>
            <span class="tag-highlight">&lt;artifactId&gt;</span>postgresql<span class="tag-highlight">&lt;/artifactId&gt;</span>
            <span class="tag-highlight">&lt;scope&gt;</span>runtime<span class="tag-highlight">&lt;/scope&gt;</span>
            <span class="comment-highlight">&lt;!-- PostgreSQL driver for database connectivity --&gt;</span>
        <span class="tag-highlight">&lt;/dependency&gt;</span>
        <span class="tag-highlight">&lt;dependency&gt;</span>
            <span class="tag-highlight">&lt;groupId&gt;</span>io.jsonwebtoken<span class="tag-highlight">&lt;/groupId&gt;</span>
            <span class="tag-highlight">&lt;artifactId&gt;</span>jjwt-api<span class="tag-highlight">&lt;/artifactId&gt;</span>
            <span class="tag-highlight">&lt;version&gt;</span>0.11.5<span class="tag-highlight">&lt;/version&gt;</span>
            <span class="comment-highlight">&lt;!-- Core JWT library for token handling --&gt;</span>
        <span class="tag-highlight">&lt;/dependency&gt;</span>
        <span class="tag-highlight">&lt;dependency&gt;</span>
            <span class="tag-highlight">&lt;groupId&gt;</span>io.jsonwebtoken<span class="tag-highlight">&lt;/groupId&gt;</span>
            <span class="tag-highlight">&lt;artifactId&gt;</span>jjwt-impl<span class="tag-highlight">&lt;/artifactId&gt;</span>
            <span class="tag-highlight">&lt;version&gt;</span>0.11.5<span class="tag-highlight">&lt;/version&gt;</span>
            <span class="tag-highlight">&lt;scope&gt;</span>runtime<span class="tag-highlight">&lt;/scope&gt;</span>
            <span class="comment-highlight">&lt;!-- JWT implementation details --&gt;</span>
        <span class="tag-highlight">&lt;/dependency&gt;</span>
        <span class="tag-highlight">&lt;dependency&gt;</span>
            <span class="tag-highlight">&lt;groupId&gt;</span>io.jsonwebtoken<span class="tag-highlight">&lt;/groupId&gt;</span>
            <span class="tag-highlight">&lt;artifactId&gt;</span>jjwt-jackson<span class="tag-highlight">&lt;/artifactId&gt;</span>
            <span class="tag-highlight">&lt;version&gt;</span>0.11.5<span class="tag-highlight">&lt;/version&gt;</span>
            <span class="tag-highlight">&lt;scope&gt;</span>runtime<span class="tag-highlight">&lt;/scope&gt;</span>
            <span class="comment-highlight">&lt;!-- JSON parsing for JWTs using Jackson --&gt;</span>
        <span class="tag-highlight">&lt;/dependency&gt;</span>
    <span class="tag-highlight">&lt;/dependencies&gt;</span>
    <span class="tag-highlight">&lt;build&gt;</span>
        <span class="tag-highlight">&lt;plugins&gt;</span>
            <span class="tag-highlight">&lt;plugin&gt;</span>
                <span class="tag-highlight">&lt;groupId&gt;</span>org.springframework.boot<span class="tag-highlight">&lt;/groupId&gt;</span>
                <span class="tag-highlight">&lt;artifactId&gt;</span>spring-boot-maven-plugin<span class="tag-highlight">&lt;/artifactId&gt;</span>
                <span class="comment-highlight">&lt;!-- Builds an executable JAR for the Spring Boot app --&gt;</span>
            <span class="tag-highlight">&lt;/plugin&gt;</span>
        <span class="tag-highlight">&lt;/plugins&gt;</span>
    <span class="tag-highlight">&lt;/build&gt;</span>
<span class="tag-highlight">&lt;/project&gt;</span>
            </pre>
            <p class="code-heading">application.properties</p>
            <pre class="code-block">
<span class="comment-highlight"># Configures the PostgreSQL database connection</span>
<span class="property-highlight">spring.datasource.url</span>=<span class="value-highlight">jdbc:postgresql://localhost:5432/teluskosecurity</span>
<span class="comment-highlight"># Database username (default for PostgreSQL)</span>
<span class="property-highlight">spring.datasource.username</span>=<span class="value-highlight">postgres</span>
<span class="comment-highlight"># Database password (replace with your actual password)</span>
<span class="property-highlight">spring.datasource.password</span>=<span class="value-highlight">yourpassword</span>
<span class="comment-highlight"># Automatically updates database schema based on entities</span>
<span class="property-highlight">spring.jpa.hibernate.ddl-auto</span>=<span class="value-highlight">update</span>
<span class="comment-highlight"># Runs the application on port 8081</span>
<span class="property-highlight">server.port</span>=<span class="value-highlight">8081</span>
            </pre>
            <p class="content-line"><strong>Summary</strong>: The <code>pom.xml</code> defines dependencies, and <code>application.properties</code> configures PostgreSQL and the port. Replace <code>yourpassword</code> with your PostgreSQL password.</p>
        </div>

        <div class="section" id="section4">
            <h2 class="section-title">4. User Model and Repository Layers</h2>
            <h3 class="subsection-title">Explanation</h3>
            <p class="content-line">The application uses a layered architecture: <strong>Model Layer</strong> (represents the user entity), <strong>Repository Layer</strong> (handles database operations using JPA), and <strong>Service Layer</strong> (manages authentication, implemented later). The example builds a user authentication system to register, log in, and manage tokens.</p>
            <h3 class="subsection-title">Key Components</h3>
            <h4>4.1. User Model</h4>
            <ul class="content-line">
                <li><strong>Purpose</strong>: Represents a user entity with fields for username, password, and role.</li>
                <li><strong>Fields</strong>:
                    <ul>
                        <li><code>username</code> (String): Unique identifier (primary key).</li>
                        <li><code>password</code> (String): Hashed password.</li>
                        <li><code>role</code> (String): User role (e.g., <code>ROLE_USER</code>).</li>
                    </ul>
                </li>
                <li><strong>Annotations</strong>:
                    <ul>
                        <li><code><span class="annotation-highlight">@Entity</span></code>: Marks the class as a JPA entity.</li>
                        <li><code><span class="annotation-highlight">@Table</span></code>: Specifies the database table name.</li>
                        <li><code><span class="annotation-highlight">@Data</span></code> (Lombok): Generates getters, setters, and <code>toString</code>.</li>
                    </ul>
                </li>
            </ul>
            <p class="code-heading">User.java</p>
            <pre class="code-block">
<span class="keyword-highlight">package</span> <span>com.example.teluskosecurity.model</span>;

<span class="keyword-highlight">import</span> <span>jakarta.persistence</span>.<span class="annotation-highlight">Entity</span>;
<span class="keyword-highlight">import</span> <span>jakarta.persistence</span>.<span class="annotation-highlight">Id</span>;
<span class="keyword-highlight">import</span> <span>jakarta.persistence</span>.<span class="annotation-highlight">Table</span>;
<span class="keyword-highlight">import</span> <span>lombok</span>.<span class="annotation-highlight">Data</span>;

<span class="comment-highlight">// Marks this class as a JPA entity for database mapping</span>
<span class="annotation-highlight">@Data</span> <span class="comment-highlight">// Lombok: Auto-generates getters, setters, toString, etc.</span>
<span class="annotation-highlight">@Entity</span>
<span class="annotation-highlight">@Table</span>(<span class="attribute-highlight">name</span> = <span class="string-highlight">"users"</span>) <span class="comment-highlight">// Maps this entity to the "users" table</span>
<span class="keyword-highlight">public</span> <span class="keyword-highlight">class</span> <span class="class-highlight">User</span> {

    <span class="annotation-highlight">@Id</span> <span class="comment-highlight">// Marks username as the primary key</span>
    <span class="keyword-highlight">private</span> <span class="class-highlight">String</span> <span>username</span>; <span class="comment-highlight">// Unique identifier for the user</span>
    <span class="keyword-highlight">private</span> <span class="class-highlight">String</span> <span>password</span>; <span class="comment-highlight">// Stores the hashed password</span>
    <span class="keyword-highlight">private</span> <span class="class-highlight">String</span> <span>role</span>; <span class="comment-highlight">// Defines user role (e.g., ROLE_USER)</span>
}
            </pre>
            <h4>4.2. User Repository</h4>
            <ul class="content-line">
                <li><strong>Purpose</strong>: Interacts with the database to perform CRUD operations on users.</li>
                <li><strong>Interface</strong>: Extends <code>JpaRepository</code> for built-in methods like <code>findById</code>.</li>
                <li><strong>Annotations</strong>:
                    <ul>
                        <li><code><span class="annotation-highlight">@Repository</span></code> (implicit in <code>JpaRepository</code>): Marks the interface as a repository.</li>
                    </ul>
                </li>
            </ul>
            <p class="code-heading">UserRepo.java</p>
            <pre class="code-block">
<span class="keyword-highlight">package</span> <span>com.example.teluskosecurity.repository</span>;

<span class="keyword-highlight">import</span> <span>com.example.teluskosecurity.model</span>.<span class="class-highlight">User</span>;
<span class="keyword-highlight">import</span> <span>org.springframework.data.jpa.repository</span>.<span class="annotation-highlight">JpaRepository</span>;

<span class="comment-highlight">// Repository interface for User entity CRUD operations</span>
<span class="keyword-highlight">public</span> <span class="keyword-highlight">interface</span> <span class="class-highlight">UserRepo</span> <span class="keyword-highlight">extends</span> <span class="annotation-highlight">JpaRepository</span>&lt;<span class="class-highlight">User</span>, <span class="class-highlight">String</span>&gt; {
    <span class="comment-highlight">// Extends JpaRepository to get methods like save(), findById()</span>
}
            </pre>
            <p class="content-line"><strong>Summary</strong>: The <code>User</code> entity maps to the <code>users</code> table, and <code>UserRepo</code> provides database access.</p>
        </div>

        <div class="section" id="section5">
            <h2 class="section-title">5. User Details Service</h2>
            <h3 class="subsection-title">Explanation</h3>
            <p class="content-line">The <code>MyUserDetailsService</code> loads user data from the database for Spring Security, mapping users to security roles.</p>
            <h3 class="subsection-title">Key Points</h3>
            <ul class="content-line">
                <li><strong>Interface</strong>: Implements <code>UserDetailsService</code> to provide user details.</li>
                <li><strong>Method</strong>: <code>loadUserByUsername</code> fetches a user by username and returns a <code>UserDetails</code> object.</li>
                <li><strong>Annotations</strong>:
                    <ul>
                        <li><code><span class="annotation-highlight">@Service</span></code>: Marks the class as a service-layer bean.</li>
                        <li><code><span class="annotation-highlight">@Autowired</span></code>: Injects <code>UserRepo</code>.</li>
                    </ul>
                </li>
            </ul>
            <p class="code-heading">MyUserDetailsService.java</p>
            <pre class="code-block">
<span class="keyword-highlight">package</span> <span>com.example.teluskosecurity.service</span>;

<span class="keyword-highlight">import</span> <span>com.example.teluskosecurity.model</span>.<span class="class-highlight">User</span>;
<span class="keyword-highlight">import</span> <span>com.example.teluskosecurity.repository</span>.<span class="class-highlight">UserRepo</span>;
<span class="keyword-highlight">import</span> <span>org.springframework.beans.factory.annotation</span>.<span class="annotation-highlight">Autowired</span>;
<span class="keyword-highlight">import</span> <span>org.springframework.security.core.authority</span>.<span class="class-highlight">SimpleGrantedAuthority</span>;
<span class="keyword-highlight">import</span> <span>org.springframework.security.core.userdetails</span>.<span class="class-highlight">UserDetails</span>;
<span class="keyword-highlight">import</span> <span>org.springframework.security.core.userdetails</span>.<span class="class-highlight">UserDetailsService</span>;
<span class="keyword-highlight">import</span> <span>org.springframework.security.core.userdetails</span>.<span class="class-highlight">UsernameNotFoundException</span>;
<span class="keyword-highlight">import</span> <span>org.springframework.stereotype</span>.<span class="annotation-highlight">Service</span>;

<span class="keyword-highlight">import</span> <span>java.util</span>.<span class="class-highlight">Collections</span>;

<span class="comment-highlight">// Service to load user details for Spring Security authentication</span>
<span class="annotation-highlight">@Service</span> <span class="comment-highlight">// Registers this class as a Spring service bean</span>
<span class="keyword-highlight">public</span> <span class="keyword-highlight">class</span> <span class="class-highlight">MyUserDetailsService</span> <span class="keyword-highlight">implements</span> <span class="class-highlight">UserDetailsService</span> {

    <span class="annotation-highlight">@Autowired</span> <span class="comment-highlight">// Injects UserRepo for database access</span>
    <span class="keyword-highlight">private</span> <span class="class-highlight">UserRepo</span> <span>userRepo</span>;

    <span class="keyword-highlight">@Override</span>
    <span class="keyword-highlight">public</span> <span class="class-highlight">UserDetails</span> <span class="method-highlight">loadUserByUsername</span>(<span class="class-highlight">String</span> <span>username</span>) <span class="keyword-highlight">throws</span> <span class="class-highlight">UsernameNotFoundException</span> {
        <span class="comment-highlight">// Fetches user from database by username</span>
        <span class="class-highlight">User</span> <span>user</span> = <span>userRepo</span>.<span class="method-highlight">findById</span>(<span>username</span>)
                .<span class="method-highlight">orElseThrow</span>(() -> <span class="keyword-highlight">new</span> <span class="class-highlight">UsernameNotFoundException</span>(<span class="string-highlight">"User not found: "</span> + <span>username</span>));
        <span class="comment-highlight">// Returns a Spring Security UserDetails object with username, password, and role</span>
        <span class="keyword-highlight">return</span> <span class="keyword-highlight">new</span> <span class="class-highlight">org.springframework.security.core.userdetails.User</span>(
                <span>user</span>.<span class="method-highlight">getUsername</span>(),
                <span>user</span>.<span class="method-highlight">getPassword</span>(),
                <span class="class-highlight">Collections</span>.<span class="method-highlight">singletonList</span>(<span class="keyword-highlight">new</span> <span class="class-highlight">SimpleGrantedAuthority</span>(<span>user</span>.<span class="method-highlight">getRole</span>()))
        );
    }

    <span class="comment-highlight">// Saves a user to the database (used during registration)</span>
    <span class="keyword-highlight">public</span> <span class="keyword-highlight">void</span> <span class="method-highlight">save</span>(<span class="class-highlight">User</span> <span>user</span>) {
        <span>userRepo</span>.<span class="method-highlight">save</span>(<span>user</span>);
    }
}
            </pre>
            <p class="content-line"><strong>Summary</strong>: <code>MyUserDetailsService</code> connects the database to Spring Security for authentication.</p>
        </div>

        <div class="section" id="section6">
            <h2 class="section-title">6. User Controller for Login and Registration</h2>
            <h3 class="subsection-title">Explanation</h3>
            <p class="content-line">The <code>UserController</code> handles user registration and login, generating JWTs and refresh tokens. It uses Spring Security for authentication and <code>JwtService</code> for token management.</p>
            <h3 class="subsection-title">Key Points</h3>
            <ul class="content-line">
                <li><strong>Endpoints</strong>:
                    <ul>
                        <li><code>/register</code>: Saves a user with a hashed password.</li>
                        <li><code>/login</code>: Authenticates and returns access and refresh tokens.</li>
                        <li><code>/refresh</code>: Generates a new access token using a refresh token.</li>
                    </ul>
                </li>
                <li><strong>Annotations</strong>:
                    <ul>
                        <li><code><span class="annotation-highlight">@RestController</span></code>: Marks the class as a REST controller.</li>
                        <li><code><span class="annotation-highlight">@Autowired</span></code>: Injects dependencies like <code>AuthenticationManager</code>, <code>JwtService</code>, and <code>PasswordEncoder</code>.</li>
                    </ul>
                </li>
            </ul>
            <p class="code-heading">UserController.java</p>
            <pre class="code-block">
<span class="keyword-highlight">package</span> <span>com.example.teluskosecurity.controller</span>;

<span class="keyword-highlight">import</span> <span>com.example.teluskosecurity.model</span>.<span class="class-highlight">User</span>;
<span class="keyword-highlight">import</span> <span>com.example.teluskosecurity.service</span>.<span class="class-highlight">JwtService</span>;
<span class="keyword-highlight">import</span> <span>com.example.teluskosecurity.service</span>.<span class="class-highlight">MyUserDetailsService</span>;
<span class="keyword-highlight">import</span> <span>org.springframework.beans.factory.annotation</span>.<span class="annotation-highlight">Autowired</span>;
<span class="keyword-highlight">import</span> <span>org.springframework.security.authentication</span>.<span class="class-highlight">AuthenticationManager</span>;
<span class="keyword-highlight">import</span> <span>org.springframework.security.authentication</span>.<span class="class-highlight">UsernamePasswordAuthenticationToken</span>;
<span class="keyword-highlight">import</span> <span>org.springframework.security.core</span>.<span class="class-highlight">Authentication</span>;
<span class="keyword-highlight">import</span> <span>org.springframework.security.crypto.password</span>.<span class="class-highlight">PasswordEncoder</span>;
<span class="keyword-highlight">import</span> <span>org.springframework.web.bind.annotation</span>.<span class="annotation-highlight">PostMapping</span>;
<span class="keyword-highlight">import</span> <span>org.springframework.web.bind.annotation</span>.<span class="annotation-highlight">RequestBody</span>;
<span class="keyword-highlight">import</span> <span>org.springframework.web.bind.annotation</span>.<span class="annotation-highlight">RequestHeader</span>;
<span class="keyword-highlight">import</span> <span>org.springframework.web.bind.annotation</span>.<span class="annotation-highlight">RestController</span>;

<span class="keyword-highlight">import</span> <span>java.util</span>.<span class="class-highlight">HashMap</span>;
<span class="keyword-highlight">import</span> <span>java.util</span>.<span class="class-highlight">Map</span>;

<span class="comment-highlight">// REST controller for handling user authentication endpoints</span>
<span class="annotation-highlight">@RestController</span>
<span class="keyword-highlight">public</span> <span class="keyword-highlight">class</span> <span class="class-highlight">UserController</span> {

    <span class="annotation-highlight">@Autowired</span> <span class="comment-highlight">// Injects AuthenticationManager for user authentication</span>
    <span class="keyword-highlight">private</span> <span class="class-highlight">AuthenticationManager</span> <span>authenticationManager</span>;

    <span class="annotation-highlight">@Autowired</span> <span class="comment-highlight">// Injects JwtService for token generation/validation</span>
    <span class="keyword-highlight">private</span> <span class="class-highlight">JwtService</span> <span>jwtService</span>;

    <span class="annotation-highlight">@Autowired</span> <span class="comment-highlight">// Injects MyUserDetailsService for user management</span>
    <span class="keyword-highlight">private</span> <span class="class-highlight">MyUserDetailsService</span> <span>userDetailsService</span>;

    <span class="annotation-highlight">@Autowired</span> <span class="comment-highlight">// Injects PasswordEncoder for hashing passwords</span>
    <span class="keyword-highlight">private</span> <span class="class-highlight">PasswordEncoder</span> <span>passwordEncoder</span>;

    <span class="annotation-highlight">@PostMapping</span>(<span class="string-highlight">"/register"</span>) <span class="comment-highlight">// Endpoint to register a new user</span>
    <span class="keyword-highlight">public</span> <span class="class-highlight">String</span> <span class="method-highlight">register</span>(<span class="annotation-highlight">@RequestBody</span> <span class="class-highlight">User</span> <span>user</span>) {
        <span class="comment-highlight">// Hashes the password before saving</span>
        <span>user</span>.<span class="method-highlight">setPassword</span>(<span>passwordEncoder</span>.<span class="method-highlight">encode</span>(<span>user</span>.<span class="method-highlight">getPassword</span>()));
        <span>userDetailsService</span>.<span class="method-highlight">save</span>(<span>user</span>); <span class="comment-highlight">// Saves user to database</span>
        <span class="keyword-highlight">return</span> <span class="string-highlight">"User registered successfully"</span>;
    }

    <span class="annotation-highlight">@PostMapping</span>(<span class="string-highlight">"/login"</span>) <span class="comment-highlight">// Endpoint to authenticate and generate tokens</span>
    <span class="keyword-highlight">public</span> <span class="class-highlight">Map</span>&lt;<span class="class-highlight">String</span>, <span class="class-highlight">String</span>&gt; <span class="method-highlight">login</span>(<span class="annotation-highlight">@RequestBody</span> <span class="class-highlight">User</span> <span>user</span>) {
        <span class="comment-highlight">// Authenticates user credentials</span>
        <span class="class-highlight">Authentication</span> <span>authentication</span> = <span>authenticationManager</span>.<span class="method-highlight">authenticate</span>(
                <span class="keyword-highlight">new</span> <span class="class-highlight">UsernamePasswordAuthenticationToken</span>(<span>user</span>.<span class="method-highlight">getUsername</span>(), <span>user</span>.<span class="method-highlight">getPassword</span>())
        );
        <span class="keyword-highlight">if</span> (<span>authentication</span>.<span class="method-highlight">isAuthenticated</span>()) {
            <span class="comment-highlight">// Generates access and refresh tokens on successful login</span>
            <span class="class-highlight">Map</span>&lt;<span class="class-highlight">String</span>, <span class="class-highlight">String</span>&gt; <span>tokens</span> = <span class="keyword-highlight">new</span> <span class="class-highlight">HashMap</span>&lt;&gt;();
            <span>tokens</span>.<span class="method-highlight">put</span>(<span class="string-highlight">"access_token"</span>, <span>jwtService</span>.<span class="method-highlight">generateToken</span>(<span>user</span>.<span class="method-highlight">getUsername</span>()));
            <span>tokens</span>.<span class="method-highlight">put</span>(<span class="string-highlight">"refresh_token"</span>, <span>jwtService</span>.<span class="method-highlight">generateRefreshToken</span>(<span>user</span>.<span class="method-highlight">getUsername</span>()));
            <span class="keyword-highlight">return</span> <span>tokens</span>;
        } <span class="keyword-highlight">else</span> {
            <span class="keyword-highlight">throw</span> <span class="keyword-highlight">new</span> <span class="class-highlight">RuntimeException</span>(<span class="string-highlight">"Login failed"</span>);
        }
    }

    <span class="annotation-highlight">@PostMapping</span>(<span class="string-highlight">"/refresh"</span>) <span class="comment-highlight">// Endpoint to refresh access token</span>
    <span class="keyword-highlight">public</span> <span class="class-highlight">Map</span>&lt;<span class="class-highlight">String</span>, <span class="class-highlight">String</span>&gt; <span class="method-highlight">refresh</span>(<span class="annotation-highlight">@RequestHeader</span>(<span class="string-highlight">"Authorization"</span>) <span class="class-highlight">String</span> <span>refreshToken</span>) {
        <span class="comment-highlight">// Extracts token from Bearer header</span>
        <span class="class-highlight">String</span> <span>token</span> = <span>refreshToken</span>.<span class="method-highlight">startsWith</span>(<span class="string-highlight">"Bearer "</span>) ? <span>refreshToken</span>.<span class="method-highlight">substring</span>(7) : <span>refreshToken</span>;
        <span class="comment-highlight">// Validates refresh token and generates new access token</span>
        <span class="class-highlight">String</span> <span>newAccessToken</span> = <span>jwtService</span>.<span class="method-highlight">validateRefreshTokenAndGenerateNewToken</span>(<span>token</span>);
        <span class="class-highlight">Map</span>&lt;<span class="class-highlight">String</span>, <span class="class-highlight">String</span>&gt; <span>tokens</span> = <span class="keyword-highlight">new</span> <span class="class-highlight">HashMap</span>&lt;&gt;();
        <span>tokens</span>.<span class="method-highlight">put</span>(<span class="string-highlight">"access_token"</span>, <span>newAccessToken</span>);
        <span class="keyword-highlight">return</span> <span>tokens</span>;
    }
}
            </pre>
            <p class="content-line"><strong>Output for /register</strong>: When sending a POST request to <code>http://localhost:8081/register</code> with JSON body <code>{"username":"naveen","password":"pass123","role":"ROLE_USER"}</code>, the response is:</p>
            <p class="content-line">User registered successfully</p>
            <p class="content-line"><strong>Output for /login</strong>: When sending a POST request to <code>http://localhost:8081/login</code> with JSON body <code>{"username":"naveen","password":"pass123"}</code>, the response is:</p>
            <pre class="code-block">
{
  <span class="string-highlight">"access_token"</span>: <span class="string-highlight">"eyJhbGciOiJIUzI1NiJ9.eyJzdWIiOiJuYXZlZW4iLCJpYXQiOjE3MjkxMDg3NTUsImV4cCI6MTcyOTEwODkzNX0.3e4f5g6h7i8j9k0l1m2n3o4p5q6r7s8t9u0v1w2x3y4z"</span>,
  <span class="string-highlight">"refresh_token"</span>: <span class="string-highlight">"eyJhbGciOiJIUzI1NiJ9.eyJzdWIiOiJuYXZlZW4iLCJpYXQiOjE3MjkxMDg3NTUsImV4cCI6MTcyOTE5NTE1NX0.5a6b7c8d9e0f1g2h3i4j5k6l7m8n9o0p1q2r3s4t5u6v"</span>
}
            </pre>
            <p class="content-line"><strong>Output for /refresh</strong>: When sending a POST request to <code>http://localhost:8081/refresh</code> with header <code>Authorization: Bearer eyJhbGciOiJIUzI1NiJ9...</code> (using the refresh token), the response is:</p>
            <pre class="code-block">
{
  <span class="string-highlight">"access_token"</span>: <span class="string-highlight">"eyJhbGciOiJIUzI1NiJ9.eyJzdWIiOiJuYXZlZW4iLCJpYXQiOjE3MjkxMDg4MDAsImV4cCI6MTcyOTEwOTAwMH0.7b8c9d0e1f2g3h4i5j6k7l8m9n0o1p2q3r4s5t6u7v8w"</span>
}
            </pre>
            <p class="content-line"><strong>Summary</strong>: Test <code>/register</code> and <code>/login</code> with Postman (POST, JSON: <code>{"username":"naveen","password":"pass123","role":"ROLE_USER"}</code>). Use <code>/refresh</code> with the refresh token in the <code>Authorization</code> header.</p>
        </div>

        <div class="section" id="section7">
            <h2 class="section-title">7. JWT Service for Token Management</h2>
            <h3 class="subsection-title">Explanation</h3>
            <p class="content-line">The <code>JwtService</code> generates and validates JWTs and refresh tokens using the <code>jjwt</code> library. It creates tokens with claims (e.g., username, expiration) and verifies their signature and validity.</p>
            <h3 class="subsection-title">Key Points</h3>
            <ul class="content-line">
                <li><strong>Methods</strong>:
                    <ul>
                        <li><code>generateToken</code>: Creates a JWT with a 3-minute expiration.</li>
                        <li><code>generateRefreshToken</code>: Creates a refresh token with a 24-hour expiration.</li>
                        <li><code>validateRefreshTokenAndGenerateNewToken</code>: Validates a refresh token and issues a new access token.</li>
                        <li><code>extractUsername</code>, <code>validateToken</code>: Extract claims and verify token validity.</li>
                    </ul>
                </li>
                <li><strong>Annotations</strong>:
                    <ul>
                        <li><code><span class="annotation-highlight">@Service</span></code>: Marks the class as a service-layer bean.</li>
                    </ul>
                </li>
                <li><strong>Security</strong>: Uses separate secret keys for access and refresh tokens.</li>
            </ul>
            <p class="code-heading">JwtService.java</p>
            <pre class="code-block">
<span class="keyword-highlight">package</span> <span>com.example.teluskosecurity.service</span>;

<span class="keyword-highlight">import</span> <span>io.jsonwebtoken</span>.<span class="class-highlight">Claims</span>;
<span class="keyword-highlight">import</span> <span>io.jsonwebtoken</span>.<span class="class-highlight">Jwts</span>;
<span class="keyword-highlight">import</span> <span>io.jsonwebtoken</span>.<span class="class-highlight">SignatureAlgorithm</span>;
<span class="keyword-highlight">import</span> <span>org.springframework.security.core.userdetails</span>.<span class="class-highlight">UserDetails</span>;
<span class="keyword-highlight">import</span> <span>org.springframework.stereotype</span>.<span class="annotation-highlight">Service</span>;

<span class="keyword-highlight">import</span> <span>java.util</span>.<span class="class-highlight">Date</span>;
<span class="keyword-highlight">import</span> <span>java.util</span>.<span class="class-highlight">HashMap</span>;
<span class="keyword-highlight">import</span> <span>java.util</span>.<span class="class-highlight">Map</span>;
<span class="keyword-highlight">import</span> <span>java.util.function</span>.<span class="class-highlight">Function</span>;

<span class="comment-highlight">// Service for generating and validating JWTs</span>
<span class="annotation-highlight">@Service</span>
<span class="keyword-highlight">public</span> <span class="keyword-highlight">class</span> <span class="class-highlight">JwtService</span> {

    <span class="comment-highlight">// Secret key for signing access tokens (Base64-encoded, replace with strong key)</span>
    <span class="keyword-highlight">private</span> <span class="class-highlight">String</span> <span>secretKey</span> = <span class="string-highlight">"c2VjcmV0LWtleS1mb3Itand0LXNpbXBsZS1leGFtcGxl"</span>;
    <span class="comment-highlight">// Separate key for refresh tokens (Base64-encoded, replace with strong key)</span>
    <span class="keyword-highlight">private</span> <span class="class-highlight">String</span> <span>refreshSecretKey</span> = <span class="string-highlight">"cmVmcmVzaC1rZXktZm9yLWp3dC1leGFtcGxl"</span>;

    <span class="comment-highlight">// Generates a JWT for the given username</span>
    <span class="keyword-highlight">public</span> <span class="class-highlight">String</span> <span class="method-highlight">generateToken</span>(<span class="class-highlight">String</span> <span>username</span>) {
        <span class="class-highlight">Map</span>&lt;<span class="class-highlight">String</span>, <span class="class-highlight">Object</span>&gt; <span>claims</span> = <span class="keyword-highlight">new</span> <span class="class-highlight">HashMap</span>&lt;&gt;();
        <span class="keyword-highlight">return</span> <span class="class-highlight">Jwts</span>.<span class="method-highlight">builder</span>()
                .<span class="method-highlight">setClaims</span>(<span>claims</span>) <span class="comment-highlight">// Sets custom claims (empty here)</span>
                .<span class="method-highlight">setSubject</span>(<span>username</span>) <span class="comment-highlight">// Sets username as the subject</span>
                .<span class="method-highlight">setIssuedAt</span>(<span class="keyword-highlight">new</span> <span class="class-highlight">Date</span>(<span class="class-highlight">System</span>.<span class="method-highlight">currentTimeMillis</span>())) <span class="comment-highlight">// Sets issuance time</span>
                .<span class="method-highlight">setExpiration</span>(<span class="keyword-highlight">new</span> <span class="class-highlight">Date</span>(<span class="class-highlight">System</span>.<span class="method-highlight">currentTimeMillis</span>() + 1000 * 60 * 3)) <span class="comment-highlight">// Expires in 3 minutes</span>
                .<span class="method-highlight">signWith</span>(<span class="class-highlight">SignatureAlgorithm</span>.<span class="class-highlight">HS256</span>, <span>secretKey</span>) <span class="comment-highlight">// Signs with HMAC-SHA256</span>
                .<span class="method-highlight">compact</span>(); <span class="comment-highlight">// Builds the token string</span>
    }

    <span class="comment-highlight">// Generates a refresh token with longer expiration</span>
    <span class="keyword-highlight">public</span> <span class="class-highlight">String</span> <span class="method-highlight">generateRefreshToken</span>(<span class="class-highlight">String</span> <span>username</span>) {
        <span class="class-highlight">Map</span>&lt;<span class="class-highlight">String</span>, <span class="class-highlight">Object</span>&gt; <span>claims</span> = <span class="keyword-highlight">new</span> <span class="class-highlight">HashMap</span>&lt;&gt;();
        <span class="keyword-highlight">return</span> <span class="class-highlight">Jwts</span>.<span class="method-highlight">builder</span>()
                .<span class="method-highlight">setClaims</span>(<span>claims</span>)
                .<span class="method-highlight">setSubject</span>(<span>username</span>)
                .<span class="method-highlight">setIssuedAt</span>(<span class="keyword-highlight">new</span> <span class="class-highlight">Date</span>(<span class="class-highlight">System</span>.<span class="method-highlight">currentTimeMillis</span>()))
                .<span class="method-highlight">setExpiration</span>(<span class="keyword-highlight">new</span> <span class="class-highlight">Date</span>(<span class="class-highlight">System</span>.<span class="method-highlight">currentTimeMillis</span>() + 1000 * 60 * 60 * 24)) <span class="comment-highlight">// Expires in 24 hours</span>
                .<span class="method-highlight">signWith</span>(<span class="class-highlight">SignatureAlgorithm</span>.<span class="class-highlight">HS256</span>, <span>refreshSecretKey</span>)
                .<span class="method-highlight">compact</span>();
    }

    <span class="comment-highlight">// Validates refresh token and generates a new access token</span>
    <span class="keyword-highlight">public</span> <span class="class-highlight">String</span> <span class="method-highlight">validateRefreshTokenAndGenerateNewToken</span>(<span class="class-highlight">String</span> <span>refreshToken</span>) {
        <span class="comment-highlight">// Parses and verifies the refresh token</span>
        <span class="class-highlight">Claims</span> <span>claims</span> = <span class="class-highlight">Jwts</span>.<span class="method-highlight">parser</span>().<span class="method-highlight">setSigningKey</span>(<span>refreshSecretKey</span>).<span class="method-highlight">parseClaimsJws</span>(<span>refreshToken</span>).<span class="method-highlight">getBody</span>();
        <span class="class-highlight">String</span> <span>username</span> = <span>claims</span>.<span class="method-highlight">getSubject</span>();
        <span class="comment-highlight">// Checks if token is not expired</span>
        <span class="keyword-highlight">if</span> (!<span>claims</span>.<span class="method-highlight">getExpiration</span>().<span class="method-highlight">before</span>(<span class="keyword-highlight">new</span> <span class="class-highlight">Date</span>())) {
            <span class="keyword-highlight">return</span> <span class="method-highlight">generateToken</span>(<span>username</span>); <span class="comment-highlight">// Generates new access token</span>
        }
        <span class="keyword-highlight">throw</span> <span class="keyword-highlight">new</span> <span class="class-highlight">IllegalArgumentException</span>(<span class="string-highlight">"Refresh token expired"</span>);
    }

    <span class="comment-highlight">// Extracts username from a token</span>
    <span class="keyword-highlight">public</span> <span class="class-highlight">String</span> <span class="method-highlight">extractUsername</span>(<span class="class-highlight">String</span> <span>token</span>) {
        <span class="keyword-highlight">return</span> <span class="method-highlight">extractClaim</span>(<span>token</span>, <span class="class-highlight">Claims</span>::<span class="method-highlight">getSubject</span>);
    }

    <span class="comment-highlight">// Generic method to extract a claim from a token</span>
    <span class="keyword-highlight">public</span> &lt;<span class="class-highlight">T</span>&gt; <span class="class-highlight">T</span> <span class="method-highlight">extractClaim</span>(<span class="class-highlight">String</span> <span>token</span>, <span class="class-highlight">Function</span>&lt;<span class="class-highlight">Claims</span>, <span class="class-highlight">T</span>&gt; <span>claimsResolver</span>) {
        <span class="keyword-highlight">final</span> <span class="class-highlight">Claims</span> <span>claims</span> = <span class="method-highlight">extractAllClaims</span>(<span>token</span>);
        <span class="keyword-highlight">return</span> <span>claimsResolver</span>.<span class="method-highlight">apply</span>(<span>claims</span>);
    }

    <span class="comment-highlight">// Parses token to extract all claims</span>
    <span class="keyword-highlight">private</span> <span class="class-highlight">Claims</span> <span class="method-highlight">extractAllClaims</span>(<span class="class-highlight">String</span> <span>token</span>) {
        <span class="keyword-highlight">return</span> <span class="class-highlight">Jwts</span>.<span class="method-highlight">parser</span>().<span class="method-highlight">setSigningKey</span>(<span>secretKey</span>).<span class="method-highlight">parseClaimsJws</span>(<span>token</span>).<span class="method-highlight">getBody</span>();
    }

    <span class="comment-highlight">// Validates token against user details</span>
    <span class="keyword-highlight">public</span> <span class="keyword-highlight">boolean</span> <span class="method-highlight">validateToken</span>(<span class="class-highlight">String</span> <span>token</span>, <span class="class-highlight">UserDetails</span> <span>userDetails</span>) {
        <span class="keyword-highlight">final</span> <span class="class-highlight">String</span> <span>username</span> = <span class="method-highlight">extractUsername</span>(<span>token</span>);
        <span class="comment-highlight">// Checks if username matches and token isn't expired</span>
        <span class="keyword-highlight">return</span> (<span>username</span>.<span class="method-highlight">equals</span>(<span>userDetails</span>.<span class="method-highlight">getUsername</span>()) && !<span class="method-highlight">isTokenExpired</span>(<span>token</span>));
    }

    <span class="comment-highlight">// Checks if token is expired</span>
    <span class="keyword-highlight">private</span> <span class="keyword-highlight">boolean</span> <span class="method-highlight">isTokenExpired</span>(<span class="class-highlight">String</span> <span>token</span>) {
        <span class="keyword-highlight">return</span> <span class="method-highlight">extractClaim</span>(<span>token</span>, <span class="class-highlight">Claims</span>::<span class="method-highlight">getExpiration</span>).<span class="method-highlight">before</span>(<span class="keyword-highlight">new</span> <span class="class-highlight">Date</span>());
    }
}
            </pre>
            <p class="content-line"><strong>Summary</strong>: <code>JwtService</code> handles token creation and validation. Replace <code>secretKey</code> and <code>refreshSecretKey</code> with strong, Base64-encoded keys.</p>
        </div>

       <div class="section" id="section8">
    <h2 class="section-title">8. JWT Filter for Authentication</h2>
    <h3 class="subsection-title">Explanation</h3>
    <p class="content-line">The <code>JwtFilter</code> intercepts requests, extracts the JWT from the <code>Authorization</code> header, validates it, and sets the authentication context for Spring Security.</p>
    <h3 class="subsection-title">Key Points</h3>
    <ul class="content-line">
        <li><strong>Purpose</strong>: Validates tokens for protected endpoints.</li>
        <li><strong>Mechanism</strong>: Checks for <code>Bearer <token></code>, extracts the username, and validates the token.</li>
        <li><strong>Annotations</strong>:
            <ul>
                <li><code><span class="annotation-highlight">@Component</span></code>: Marks the class as a Spring-managed bean.</li>
                <li><code><span class="annotation-highlight">@Autowired</span></code>: Injects <code>JwtService</code> and <code>ApplicationContext</code>.</li>
            </ul>
        </li>
        <li><strong>Integration</strong>: Added to the Spring Security filter chain.</li>
    </ul>
    <p class="code-heading">JwtFilter.java</p>
    <pre class="code-block">
<span class="keyword-highlight">package</span> <span>com.example.teluskosecurity.config</span>;

<span class="keyword-highlight">import</span> <span>com.example.teluskosecurity.service</span>.<span class="class-highlight">JwtService</span>;
<span class="keyword-highlight">import</span> <span>com.example.teluskosecurity.service</span>.<span class="class-highlight">MyUserDetailsService</span>;
<span class="keyword-highlight">import</span> <span>org.springframework.beans.factory.annotation</span>.<span class="annotation-highlight">Autowired</span>;
<span class="keyword-highlight">import</span> <span>org.springframework.context</span>.<span class="class-highlight">ApplicationContext</span>;
<span class="keyword-highlight">import</span> <span>org.springframework.security.authentication</span>.<span class="class-highlight">UsernamePasswordAuthenticationToken</span>;
<span class="keyword-highlight">import</span> <span>org.springframework.security.core.context</span>.<span class="class-highlight">SecurityContextHolder</span>;
<span class="keyword-highlight">import</span> <span>org.springframework.security.core.userdetails</span>.<span class="class-highlight">UserDetails</span>;
<span class="keyword-highlight">import</span> <span>org.springframework.security.web.authentication</span>.<span class="class-highlight">WebAuthenticationDetailsSource</span>;
<span class="keyword-highlight">import</span> <span>org.springframework.stereotype</span>.<span class="annotation-highlight">Component</span>;
<span class="keyword-highlight">import</span> <span>org.springframework.web.filter</span>.<span class="class-highlight">OncePerRequestFilter</span>;

<span class="keyword-highlight">import</span> <span>javax.servlet</span>.<span class="class-highlight">FilterChain</span>;
<span class="keyword-highlight">import</span> <span>javax.servlet</span>.<span class="class-highlight">ServletException</span>;
<span class="keyword-highlight">import</span> <span>javax.servlet.http</span>.<span class="class-highlight">HttpServletRequest</span>;
<span class="keyword-highlight">import</span> <span>javax.servlet.http</span>.<span class="class-highlight">HttpServletResponse</span>;
<span class="keyword-highlight">import</span> <span>java.io</span>.<span class="class-highlight">IOException</span>;

<span class="comment-highlight">// Filter to validate JWTs in incoming requests</span>
<span class="annotation-highlight">@Component</span> <span class="comment-highlight">// Registers as a Spring bean</span>
<span class="keyword-highlight">public</span> <span class="keyword-highlight">class</span> <span class="class-highlight">JwtFilter</span> <span class="keyword-highlight">extends</span> <span class="class-highlight">OncePerRequestFilter</span> {

    <span class="annotation-highlight">@Autowired</span> <span class="comment-highlight">// Injects JwtService for token operations</span>
    <span class="keyword-highlight">private</span> <span class="class-highlight">JwtService</span> <span>jwtService</span>;

    <span class="annotation-highlight">@Autowired</span> <span class="comment-highlight">// Injects ApplicationContext to access beans</span>
    <span class="keyword-highlight">private</span> <span class="class-highlight">ApplicationContext</span> <span>context</span>;

    <span class="keyword-highlight">@Override</span>
    <span class="keyword-highlight">protected</span> <span class="keyword-highlight">void</span> <span class="method-highlight">doFilterInternal</span>(<span class="class-highlight">HttpServletRequest</span> <span>request</span>, <span class="class-highlight">HttpServletResponse</span> <span>response</span>, <span class="class-highlight">FilterChain</span> <span>filterChain</span>)
            <span class="keyword-highlight">throws</span> <span class="class-highlight">ServletException</span>, <span class="class-highlight">IOException</span> {
        <span class="comment-highlight">// Gets Authorization header from request</span>
        <span class="class-highlight">String</span> <span>authHeader</span> = <span>request</span>.<span class="method-highlight">getHeader</span>(<span class="string-highlight">"Authorization"</span>);
        <span class="class-highlight">String</span> <span>token</span> = <span class="keyword-highlight">null</span>;
        <span class="class-highlight">String</span> <span>username</span> = <span class="keyword-highlight">null</span>;

        <span class="comment-highlight">// Checks for Bearer token in header</span>
        <span class="keyword-highlight">if</span> (<span>authHeader</span> != <span class="keyword-highlight">null</span> && <span>authHeader</span>.<span class="method-highlight">startsWith</span>(<span class="string-highlight">"Bearer "</span>)) {
            <span>token</span> = <span>authHeader</span>.<span class="method-highlight">substring</span>(7); <span class="comment-highlight">// Extracts token (removes "Bearer ")</span>
            <span>username</span> = <span>jwtService</span>.<span class="method-highlight">extractUsername</span>(<span>token</span>); <span class="comment-highlight">// Gets username from token</span>
        }

        <span class="comment-highlight">// If username exists and no authentication is set</span>
        <span class="keyword-highlight">if</span> (<span>username</span> != <span class="keyword-highlight">null</span> && <span class="class-highlight">SecurityContextHolder</span>.<span class="method-highlight">getContext</span>().<span class="method-highlight">getAuthentication</span>() == <span class="keyword-highlight">null</span>) {
            <span class="comment-highlight">// Loads user details from database</span>
            <span class="class-highlight">UserDetails</span> <span>userDetails</span> = <span>context</span>.<span class="method-highlight">getBean</span>(<span class="class-highlight">MyUserDetailsService</span>.<span class="keyword-highlight">class</span>).<span class="method-highlight">loadUserByUsername</span>(<span>username</span>);
            <span class="comment-highlight">// Validates token against user details</span>
            <span class="keyword-highlight">if</span> (<span>jwtService</span>.<span class="method-highlight">validateToken</span>(<span>token</span>, <span>userDetails</span>)) {
                <span class="comment-highlight">// Sets authentication in SecurityContext</span>
                <span class="class-highlight">UsernamePasswordAuthenticationToken</span> <span>authToken</span> = <span class="keyword-highlight">new</span> <span class="class-highlight">UsernamePasswordAuthenticationToken</span>(
                        <span>userDetails</span>, <span class="keyword-highlight">null</span>, <span>userDetails</span>.<span class="method-highlight">getAuthorities</span>());
                <span>authToken</span>.<span class="method-highlight">setDetails</span>(<span class="keyword-highlight">new</span> <span class="class-highlight">WebAuthenticationDetailsSource</span>().<span class="method-highlight">buildDetails</span>(<span>request</span>));
                <span class="class-highlight">SecurityContextHolder</span>.<span class="method-highlight">getContext</span>().<span class="method-highlight">setAuthentication</span>(<span>authToken</span>);
            }
        }
        <span class="comment-highlight">// Continues the filter chain</span>
        <span>filterChain</span>.<span class="method-highlight">doFilter</span>(<span>request</span>, <span>response</span>);
    }
}
    </pre>
    <p class="content-line"><strong>Summary</strong>: The <code>JwtFilter</code> ensures only valid tokens access protected endpoints.</p>
</div>

<div class="section" id="section9">
    <h2 class="section-title">9. Security Configuration</h2>
    <h3 class="subsection-title">Explanation</h3>
    <p class="content-line">The <code>SecurityConfig</code> configures Spring Security to use the <code>JwtFilter</code>, allow public endpoints, and enforce stateless sessions.</p>
    <h3 class="subsection-title">Key Points</h3>
    <ul class="content-line">
        <li><strong>Configuration</strong>:
            <ul>
                <li>Disables CSRF (not needed for stateless APIs).</li>
                <li>Permits <code>/register</code>, <code>/login</code>, and <code>/refresh</code> endpoints.</li>
                <li>Requires authentication for other endpoints.</li>
                <li>Uses stateless session management.</li>
            </ul>
        </li>
        <li><strong>Beans</strong>:
            <ul>
                <li><code>SecurityFilterChain</code>: Defines security rules.</li>
                <li><code>AuthenticationManager</code>: Handles authentication.</li>
                <li><code>PasswordEncoder</code>: Hashes passwords using BCrypt.</li>
            </ul>
        </li>
        <li><strong>Annotations</strong>:
            <ul>
                <li><code><span class="annotation-highlight">@Configuration</span></code>: Marks the class as a configuration bean.</li>
                <li><code><span class="annotation-highlight">@Autowired</span></code>: Injects <code>JwtFilter</code>.</li>
            </ul>
        </li>
    </ul>
    <p class="code-heading">SecurityConfig.java</p>
    <pre class="code-block">
<span class="keyword-highlight">package</span> <span>com.example.teluskosecurity.config</span>;

<span class="keyword-highlight">import</span> <span>org.springframework.beans.factory.annotation</span>.<span class="annotation-highlight">Autowired</span>;
<span class="keyword-highlight">import</span> <span>org.springframework.context.annotation</span>.<span class="annotation-highlight">Bean</span>;
<span class="keyword-highlight">import</span> <span>org.springframework.context.annotation</span>.<span class="annotation-highlight">Configuration</span>;
<span class="keyword-highlight">import</span> <span>org.springframework.security.authentication</span>.<span class="class-highlight">AuthenticationManager</span>;
<span class="keyword-highlight">import</span> <span>org.springframework.security.config.annotation.authentication.configuration</span>.<span class="class-highlight">AuthenticationConfiguration</span>;
<span class="keyword-highlight">import</span> <span>org.springframework.security.config.annotation.web.builders</span>.<span class="class-highlight">HttpSecurity</span>;
<span class="keyword-highlight">import</span> <span>org.springframework.security.config.http</span>.<span class="class-highlight">SessionCreationPolicy</span>;
<span class="keyword-highlight">import</span> <span>org.springframework.security.crypto.bcrypt</span>.<span class="class-highlight">BCryptPasswordEncoder</span>;
<span class="keyword-highlight">import</span> <span>org.springframework.security.crypto.password</span>.<span class="class-highlight">PasswordEncoder</span>;
<span class="keyword-highlight">import</span> <span>org.springframework.security.web</span>.<span class="class-highlight">SecurityFilterChain</span>;
<span class="keyword-highlight">import</span> <span>org.springframework.security.web.authentication</span>.<span class="class-highlight">UsernamePasswordAuthenticationFilter</span>;

<span class="comment-highlight">// Configures Spring Security for JWT-based authentication</span>
<span class="annotation-highlight">@Configuration</span>
<span class="keyword-highlight">public</span> <span class="keyword-highlight">class</span> <span class="class-highlight">SecurityConfig</span> {

    <span class="annotation-highlight">@Autowired</span> <span class="comment-highlight">// Injects JwtFilter for token validation</span>
    <span class="keyword-highlight">private</span> <span class="class-highlight">JwtFilter</span> <span>jwtFilter</span>;

    <span class="annotation-highlight">@Bean</span> <span class="comment-highlight">// Defines security rules</span>
    <span class="keyword-highlight">public</span> <span class="class-highlight">SecurityFilterChain</span> <span class="method-highlight">securityFilterChain</span>(<span class="class-highlight">HttpSecurity</span> <span>http</span>) <span class="keyword-highlight">throws</span> <span class="class-highlight">Exception</span> {
        <span>http</span>.<span class="method-highlight">csrf</span>().<span class="method-highlight">disable</span>() <span class="comment-highlight">// Disables CSRF (not needed for stateless APIs)</span>
                .<span class="method-highlight">authorizeRequests</span>()
                .<span class="method-highlight">antMatchers</span>(<span class="string-highlight">"/register"</span>, <span class="string-highlight">"/login"</span>, <span class="string-highlight">"/refresh"</span>).<span class="method-highlight">permitAll</span>() <span class="comment-highlight">// Allows public access to these endpoints</span>
                .<span class="method-highlight">anyRequest</span>().<span class="method-highlight">authenticated</span>() <span class="comment-highlight">// Requires authentication for all other endpoints</span>
                .<span class="keyword-highlight">and</span>()
                .<span class="method-highlight">sessionManagement</span>().<span class="method-highlight">sessionCreationPolicy</span>(<span class="class-highlight">SessionCreationPolicy</span>.<span class="class-highlight">STATELESS</span>); <span class="comment-highlight">// Enforces stateless sessions</span>
        <span>http</span>.<span class="method-highlight">addFilterBefore</span>(<span>jwtFilter</span>, <span class="class-highlight">UsernamePasswordAuthenticationFilter</span>.<span class="keyword-highlight">class</span>); <span class="comment-highlight">// Adds JWT filter</span>
        <span class="keyword-highlight">return</span> <span>http</span>.<span class="method-highlight">build</span>();
    }

    <span class="annotation-highlight">@Bean</span> <span class="comment-highlight">// Provides AuthenticationManager for authentication</span>
    <span class="keyword-highlight">public</span> <span class="class-highlight">AuthenticationManager</span> <span class="method-highlight">authenticationManager</span>(<span class="class-highlight">AuthenticationConfiguration</span> <span>config</span>) <span class="keyword-highlight">throws</span> <span class="class-highlight">Exception</span> {
        <span class="keyword-highlight">return</span> <span>config</span>.<span class="method-highlight">getAuthenticationManager</span>();
    }

    <span class="annotation-highlight">@Bean</span> <span class="comment-highlight">// Configures BCrypt for password hashing</span>
    <span class="keyword-highlight">public</span> <span class="class-highlight">PasswordEncoder</span> <span class="method-highlight">passwordEncoder</span>() {
        <span class="keyword-highlight">return</span> <span class="keyword-highlight">new</span> <span class="class-highlight">BCryptPasswordEncoder</span>();
    }
}
    </pre>
    <p class="content-line"><strong>Summary</strong>: <code>SecurityConfig</code> sets up stateless authentication with the <code>JwtFilter</code>.</p>
</div>

<div class="section" id="section10">
    <h2 class="section-title">10. Creating an OAuth2-Based Spring Boot Project</h2>
    <h3 class="subsection-title">Explanation</h3>
    <p class="content-line">OAuth2 allows users to log in using third-party providers (e.g., Google, GitHub), avoiding local credential management. It’s like using your Google account to access a website. The user authenticates with the provider, which issues a token to the app for accessing resources (e.g., user email).</p>
    <h3 class="subsection-title">Key Steps</h3>
    <ol class="content-line">
        <li><strong>Spring Initializr Setup</strong>:
            <ul>
                <li><strong>Project Type</strong>: Maven</li>
                <li><strong>Language</strong>: Java</li>
                <li><strong>Spring Boot Version</strong>: 3.1.x</li>
                <li><strong>Group ID</strong>: <code>com.telescope</code></li>
                <li><strong>Artifact ID</strong>: <code>oauth2demo</code></li>
                <li><strong>Packaging</strong>: JAR</li>
                <li><strong>Java Version</strong>: 17</li>
                <li><strong>Dependencies</strong>:
                    <ul>
                        <li><strong>Spring Boot Starter Web</strong>: For REST APIs.</li>
                        <li><strong>Spring Security OAuth2 Client</strong>: For OAuth2 login.</li>
                    </ul>
                </li>
            </ul>
        </li>
        <li><strong>Project Generation</strong>: Generate, download, and unzip the project. Open in an IDE.</li>
        <li><strong>Configure OAuth2</strong>: Set up Google and GitHub credentials in <code>application.properties</code>.</li>
        <li><strong>Run the Application</strong>: Test with a simple endpoint (<code>/hello</code>).</li>
    </ol>
    <h3 class="subsection-title">Code Reference</h3>
    <p class="code-heading">HelloController.java</p>
    <pre class="code-block">
<span class="keyword-highlight">package</span> <span>com.telescope.controller</span>;

<span class="keyword-highlight">import</span> <span>org.springframework.web.bind.annotation</span>.<span class="annotation-highlight">GetMapping</span>;
<span class="keyword-highlight">import</span> <span>org.springframework.web.bind.annotation</span>.<span class="annotation-highlight">RestController</span>;

<span class="comment-highlight">// Simple REST controller for testing OAuth2 login</span>
<span class="annotation-highlight">@RestController</span>
<span class="keyword-highlight">public</span> <span class="keyword-highlight">class</span> <span class="class-highlight">HelloController</span> {

    <span class="annotation-highlight">@GetMapping</span>(<span class="string-highlight">"/hello"</span>) <span class="comment-highlight">// Endpoint accessible after OAuth2 authentication</span>
    <span class="keyword-highlight">public</span> <span class="class-highlight">String</span> <span class="method-highlight">greet</span>() {
        <span class="keyword-highlight">return</span> <span class="string-highlight">"Welcome to the Disco"</span>; <span class="comment-highlight">// Returns a welcome message</span>
    }
}
    </pre>
    <p class="content-line"><strong>Output for /hello</strong>: When accessing <code>http://localhost:8000/hello</code> after successful OAuth2 login (e.g., via Google or GitHub), the response is:</p>
    <p class="content-line">Welcome to the Disco</p>
    <p class="code-heading">application.properties</p>
    <pre class="code-block">
<span class="comment-highlight"># Runs the application on port 8000</span>
<span class="property-highlight">server.port</span>=<span class="value-highlight">8000</span>
<span class="comment-highlight"># Configures Google OAuth2 client credentials</span>
<span class="property-highlight">spring.security.oauth2.client.registration.google.client-id</span>=<span class="value-highlight">your-google-client-id</span>
<span class="property-highlight">spring.security.oauth2.client.registration.google.client-secret</span>=<span class="value-highlight">your-google-client-secret</span>
<span class="comment-highlight"># Configures GitHub OAuth2 client credentials</span>
<span class="property-highlight">spring.security.oauth2.client.registration.github.client-id</span>=<span class="value-highlight">your-github-client-id</span>
<span class="property-highlight">spring.security.oauth2.client.registration.github.client-secret</span>=<span class="value-highlight">your-github-client-secret</span>
    </pre>
    <p class="code-heading">SecurityConfig.java</p>
    <pre class="code-block">
<span class="keyword-highlight">package</span> <span>com.telescope.config</span>;

<span class="keyword-highlight">import</span> <span>org.springframework.context.annotation</span>.<span class="annotation-highlight">Bean</span>;
<span class="keyword-highlight">import</span> <span>org.springframework.context.annotation</span>.<span class="annotation-highlight">Configuration</span>;
<span class="keyword-highlight">import</span> <span>org.springframework.security.config.annotation.web.builders</span>.<span class="class-highlight">HttpSecurity</span>;
<span class="keyword-highlight">import</span> <span>org.springframework.security.web</span>.<span class="class-highlight">SecurityFilterChain</span>;

<span class="comment-highlight">// Configures Spring Security for OAuth2 login</span>
<span class="annotation-highlight">@Configuration</span>
<span class="keyword-highlight">public</span> <span class="keyword-highlight">class</span> <span class="class-highlight">SecurityConfig</span> {

    <span class="annotation-highlight">@Bean</span> <span class="comment-highlight">// Defines OAuth2 security rules</span>
    <span class="keyword-highlight">public</span> <span class="class-highlight">SecurityFilterChain</span> <span class="method-highlight">defaultSecurityFilterChain</span>(<span class="class-highlight">HttpSecurity</span> <span>http</span>) <span class="keyword-highlight">throws</span> <span class="class-highlight">Exception</span> {
        <span>http</span>.<span class="method-highlight">authorizeHttpRequests</span>(<span>auth</span> -> <span>auth</span>.<span class="method-highlight">anyRequest</span>().<span class="method-highlight">authenticated</span>()) <span class="comment-highlight">// Requires authentication for all requests</span>
                .<span class="method-highlight">oauth2Login</span>().<span class="method-highlight">defaultSuccessUrl</span>(<span class="string-highlight">"/hello"</span>); <span class="comment-highlight">// Redirects to /hello after successful login</span>
        <span class="keyword-highlight">return</span> <span>http</span>.<span class="method-highlight">build</span>();
    }
}
    </pre>
    <p class="content-line"><strong>Summary</strong>: Test <code>/hello</code> at <code>http://localhost:8000/hello</code>. Log in with Google or GitHub to see “Welcome to the Disco”. Replace placeholders with your OAuth2 credentials.</p>
</div>

<div class="section" id="section11">
    <h2 class="section-title">11. Token Storage Best Practices</h2>
    <h3 class="subsection-title">Explanation</h3>
    <p class="content-line">Storing JWTs securely prevents theft. In browsers, avoid <code>localStorage</code> due to XSS (cross-site scripting) risks, where attackers can steal tokens via JavaScript. Use <strong>HttpOnly cookies</strong>, which are inaccessible to JavaScript and sent automatically with requests. For mobile apps, use secure storage like Keychain (iOS) or Keystore (Android).</p>
    <h3 class="subsection-title">Key Points</h3>
    <ul class="content-line">
        <li><strong>HttpOnly Cookies</strong>:
            <ul>
                <li>Set <code>HttpOnly</code> to block JavaScript access.</li>
                <li>Set <code>Secure</code> for HTTPS-only transmission.</li>
                <li>Use short expirations (e.g., 3 minutes for access tokens).</li>
            </ul>
        </li>
        <li><strong>Refresh Tokens</strong>: Store more securely due to longer validity (e.g., 24 hours).</li>
        <li><strong>Mobile Apps</strong>: Use platform-specific secure storage.</li>
    </ul>
    <p class="code-heading">CookieConfig.java</p>
    <pre class="code-block">
<span class="keyword-highlight">package</span> <span>com.example.teluskosecurity.config</span>;

<span class="keyword-highlight">import</span> <span>org.springframework.context.annotation</span>.<span class="annotation-highlight">Configuration</span>;
<span class="keyword-highlight">import</span> <span>javax.servlet.http</span>.<span class="class-highlight">Cookie</span>;
<span class="keyword-highlight">import</span> <span>javax.servlet.http</span>.<span class="class-highlight">HttpServletResponse</span>;

<span class="comment-highlight">// Configures secure cookie storage for JWTs</span>
<span class="annotation-highlight">@Configuration</span>
<span class="keyword-highlight">public</span> <span class="keyword-highlight">class</span> <span class="class-highlight">CookieConfig</span> {

    <span class="comment-highlight">// Sets a secure, HttpOnly cookie for the JWT</span>
    <span class="keyword-highlight">public</span> <span class="keyword-highlight">static</span> <span class="keyword-highlight">void</span> <span class="method-highlight">setJwtCookie</span>(<span class="class-highlight">HttpServletResponse</span> <span>response</span>, <span class="class-highlight">String</span> <span>token</span>) {
        <span class="class-highlight">Cookie</span> <span>cookie</span> = <span class="keyword-highlight">new</span> <span class="class-highlight">Cookie</span>(<span class="string-highlight">"jwt"</span>, <span>token</span>);
        <span>cookie</span>.<span class="method-highlight">setHttpOnly</span>(<span class="keyword-highlight">true</span>); <span class="comment-highlight">// Prevents JavaScript access</span>
        <span>cookie</span>.<span class="method-highlight">setSecure</span>(<span class="keyword-highlight">true</span>); <span class="comment-highlight">// Ensures HTTPS-only transmission</span>
        <span>cookie</span>.<span class="method-highlight">setPath</span>(<span class="string-highlight">"/"</span>); <span class="comment-highlight">// Makes cookie available for all paths</span>
        <span>cookie</span>.<span class="method-highlight">setMaxAge</span>(3 * 60); <span class="comment-highlight">// Expires in 3 minutes</span>
        <span>response</span>.<span class="method-highlight">addCookie</span>(<span>cookie</span>); <span class="comment-highlight">// Adds cookie to response</span>
    }
}
    </pre>
    <p class="content-line"><strong>Summary</strong>: Update <code>UserController</code> to use <code>CookieConfig.setJwtCookie</code> after generating a JWT.</p>
</div>

<div class="section" id="section12">
    <h2 class="section-title">12. Common JWT Pitfalls</h2>
    <h3 class="subsection-title">Explanation</h3>
    <p class="content-line">Avoiding common mistakes ensures secure JWT usage.</p>
    <h3 class="subsection-title">Key Points</h3>
    <ol class="content-line">
        <li><strong>Storing Sensitive Data</strong>: The Payload is Base64-encoded (not encrypted), so anyone can decode it. Avoid passwords or sensitive data.</li>
        <li><strong>Long Expiration Times</strong>: Use short-lived tokens (e.g., 15 minutes) and refresh tokens for longer sessions.</li>
        <li><strong>Weak Secret Keys</strong>: Use strong, random keys (256+ bits) stored in environment variables.</li>
        <li><strong>Ignoring Expiration</strong>: Always check the <code>exp</code> claim to reject expired tokens.</li>
        <li><strong>Not Validating Algorithms</strong>: Prevent “alg:none” attacks by specifying allowed algorithms in <code>JwtService</code>.</li>
    </ol>
    <p class="content-line black-highlight"><strong>Beginner Tip</strong>: Treat JWTs like cash—keep them safe, don’t share them, and replace them if lost.</p>
</div>

<div class="section" id="section13">
    <h2 class="section-title">13. Databases Used</h2>
    <table>
        <tr>
            <th>Database</th>
            <th>Type</th>
            <th>Description</th>
            <th>Configuration</th>
            <th>Use Case</th>
        </tr>
        <tr>
            <td>PostgreSQL</td>
            <td>External (RDBMS)</td>
            <td>Persistent, production-grade database; requires external setup.</td>
            <td>Configured in <code>application.properties</code> with URL, username, password, driver class.</td>
            <td>Production, persistent storage</td>
        </tr>
    </table>
</div>

<div class="section" id="section14">
    <h2 class="section-title">14. Key Takeaways</h2>
    <ul class="content-line">
        <li><strong>JWT</strong>: Enables stateless authentication with signed tokens, ideal for scalability.</li>
        <li><strong>OAuth2</strong>: Simplifies login using third-party providers like Google and GitHub.</li>
        <li><strong>Spring Security</strong>: Integrates JWT and OAuth2 with filters and configurations.</li>
        <li><strong>Refresh Tokens</strong>: Extend sessions securely without re-login.</li>
        <li><strong>Security Practices</strong>: Use HttpOnly cookies and strong keys to protect tokens.</li>
        <li><strong>Portability</strong>: Easily extend the setup for additional features like role-based access.</li>
    </ul>
</div>

<div class="section" id="section15">
    <h2 class="section-title">15. Instructions for Testing and Integration</h2>
    <ul class="content-line">
        <li><strong>Setup</strong>:
            <ul>
                <li>Clone the <a href="https://github.com/navinreddy20/spring6-course/tree/80e0c059c5c259ef6009838a934ed9e92865c3d7/14.1%20JWT">GitHub repo</a> or create a Spring Boot project with the provided <code>pom.xml</code>.</li>
                <li>Replace placeholders in <code>application.properties</code> and <code>JwtService</code> with your PostgreSQL details and secret keys.</li>
            </ul>
        </li>
        <li><strong>JWT Testing</strong>:
            <ul>
                <li>Use Postman to test <code>/register</code> and <code>/login</code> (POST, JSON: <code>{"username":"naveen","password":"pass123","role":"ROLE_USER"}</code>).</li>
                <li>Send the JWT in the <code>Authorization</code> header (<code>Bearer <token></code>) for protected endpoints.</li>
                <li>Test <code>/refresh</code> with the refresh token in the <code>Authorization</code> header.</li>
            </ul>
        </li>
        <li><strong>OAuth2 Testing</strong>:
            <ul>
                <li>Access <code>http://localhost:8000/hello</code>, log in with Google or GitHub, and verify redirection to “Welcome to the Disco”.</li>
            </ul>
        </li>
        <li><strong>Ports</strong>:
            <ul>
                <li>Run the JWT app on port 8081 and the OAuth2 app on port 8000.</li>
            </ul>
        </li>
        <li><strong>Security</strong>:
            <ul>
                <li>Store secret keys in environment variables.</li>
                <li>Use HttpOnly cookies for token storage.</li>
                <li>Set short JWT expirations (e.g., 3 minutes).</li>
            </ul>
        </li>
        <li><strong>Integration</strong>:
            <ul>
                <li>Copy artifacts into your project, ensuring package names match (<code>com.example.teluskosecurity</code> for JWT, <code>com.telescope</code> for OAuth2).</li>
                <li>Update OAuth2 client IDs and secrets in <code>application.properties</code>.</li>
            </ul>
        </li>
    </ul>
</div>

<div class="section" id="section16">
    <h2 class="section-title">16. Additional Notes</h2>
    <ul class="content-line">
        <li><strong>Code Repository</strong>: <a href="https://github.com/navinreddy20/spring6-course/tree/80e0c059c5c259ef6009838a934ed9e92865c3d7/14.1%20JWT">GitHub - navinreddy20/spring6-course</a>.</li>
        <li><strong>Error Debugging</strong>: Common errors include invalid tokens (check signatures) or missing configurations (verify <code>application.properties</code>).</li>
        <li><strong>Security Enhancements</strong>: Consider adding role-based access control or token revocation mechanisms.</li>
        <li><strong>Testing Tools</strong>: Use <a href="https://jwt.io">jwt.io</a> to decode and inspect JWTs.</li>
    </ul>
</div>
  <script>
        function changeBackground() {
            const select = document.getElementById('bg-select');
            const body = document.body;
            body.className = select.value;
        }
    </script>
</body>
</html>